<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
<title>Nurten ƒ∞la√ß Paneli</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="ƒ∞la√ß Paneli">

<style>
/* --- A√áIK (LIGHT) MOD RENKLERƒ∞ - G√ñZ YORMAYAN ANTRASƒ∞T METƒ∞NLER --- */
:root {
  --bg: #F4F4F7; 
  --card: #FFFFFF; 
  --text: #2C2C2E; 
  --muted: #8E8E93; 
  --line: rgba(0,0,0,0.06);
  --accent: #34C759; 
  --warning: #FF9500; 
  --danger: #FF3B30; 
  --early: #007AFF; 
  --purple: #AF52DE; 
  
  --vip-bg: linear-gradient(135deg, #2C2C2E 0%, #1C1C1E 100%);
  --vip-text: #FFFFFF;
  --vip-muted: #A0AAB5;
  --vip-gold: #F1C40F;
  --vip-shadow: 0 12px 24px rgba(0,0,0,0.15);

  --card-border: rgba(0,0,0,0.03);
  --card-shadow: 0 10px 30px rgba(0,0,0,0.06);

  --done-bg: rgba(52, 199, 89, 0.04);
  --done-border: rgba(52, 199, 89, 0.3);
  --prog-daily: linear-gradient(90deg, #32D74B, #28CD41);
  --prog-month: linear-gradient(90deg, #0A84FF, #007AFF);
  --wait-badge-bg: rgba(0,0,0,0.05);
  --wait-badge-text: #636366; 
}

/* --- KARANLIK (DARK) MOD RENKLERƒ∞ - PARLAMA √ñNLEYƒ∞Cƒ∞ KUR≈ûUNƒ∞ ZEMƒ∞N --- */
@media (prefers-color-scheme: dark) {
  :root { 
    --bg: #0B0B0E; 
    --card: #1C1C1E; 
    --text: #EAEBEE; 
    --muted: #98989D; 
    --line: rgba(255,255,255,0.08);
    --accent: #32D74B; 
    --warning: #FF9D0A; 
    --danger: #FF453A; 
    --early: #0A84FF; 
    --purple: #BF5AF2;
    
    --vip-bg: linear-gradient(135deg, #2C2C2E 0%, #1C1C1E 100%);
    --vip-text: #FFFFFF;
    --vip-muted: #98989D;
    --vip-gold: #F1C40F;
    --vip-shadow: 0 12px 30px rgba(0,0,0,0.5);

    --card-border: rgba(255,255,255,0.05);
    --card-shadow: 0 10px 30px rgba(0,0,0,0.4);

    --done-bg: rgba(50, 215, 75, 0.05);
    --done-border: rgba(50, 215, 75, 0.3);
    --prog-daily: linear-gradient(90deg, #30D158, #32D74B);
    --prog-month: linear-gradient(90deg, #0A84FF, #64D2FF);
    --wait-badge-bg: rgba(255,255,255,0.1);
    --wait-badge-text: #D1D1D6; 
  }
}

* { box-sizing: border-box; }
body { margin: 0; background: var(--bg); color: var(--text); font-family: -apple-system, system-ui, sans-serif; padding: 12px 12px 85px 12px; -webkit-font-smoothing: antialiased; overflow-x: hidden; transition: background 0.3s, color 0.3s; }

/* G√úVENLƒ∞K KALKANI */
#alertsArea { display: flex; flex-direction: column; gap: 8px; margin-bottom: 14px; }
.safety-shield { display: none; padding: 14px; text-align: center; font-weight: 800; font-size: 13px; border-radius: 16px; box-shadow: var(--card-shadow); letter-spacing: 0.3px; color: white; }
.shield-red { background: linear-gradient(135deg, #ff453a 0%, #d70015 100%); animation: pulse-red 2.5s ease-in-out infinite; }
.shield-yellow { background: linear-gradient(135deg, #ff9d0a 0%, #c35900 100%); animation: pulse-yellow 2.5s ease-in-out infinite; }
.shield-purple { background: linear-gradient(135deg, #bf5af2 0%, #5e5ce6 100%); animation: pulse-purple 2.5s ease-in-out infinite; }
.shield-blue { background: linear-gradient(135deg, #0a84ff 0%, #0040dd 100%); }

@keyframes pulse-red { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
@keyframes pulse-yellow { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
@keyframes pulse-purple { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

/* VIP BA≈ûLIK KARTI */
.vip-header { background: var(--vip-bg); border-radius: 24px; padding: 20px 16px; margin-bottom: 14px; box-shadow: var(--vip-shadow); color: var(--vip-text); position: relative; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); }

.app-title { font-size: 22px; font-weight: 800; letter-spacing: -0.5px; margin-bottom: 8px; display: flex; justify-content: center; align-items: center; gap: 6px; flex-wrap: wrap; position: relative; z-index: 1;}
.app-title .greeting { font-size: 15px; font-weight: 700; color: var(--vip-muted); }
.app-title .name-tag { white-space: nowrap; color: var(--vip-text); }
.header-info { display: flex; justify-content: center; align-items: center; gap: 8px; position: relative; z-index: 1;}
.clock-text { font-size: 13px; font-weight: 700; color: var(--vip-muted); }
.sync-badge { font-size: 11px; font-weight: 800; padding: 4px 10px; border-radius: 10px; background: rgba(255,255,255,0.1); color: var(--vip-text); backdrop-filter: blur(4px); }

/* T√úM KARTLARIN ORTAK SINIFI */
.premium-card { 
    background: var(--card); 
    border-radius: 24px; 
    padding: 18px; 
    border: 1px solid var(--card-border); 
    margin-bottom: 14px; 
    box-shadow: var(--card-shadow); 
    transition: all 0.3s ease;
    overflow: hidden;
}

/* --- PREMIUM HAVA DURUMU D√úZENƒ∞ --- */
.weather-details { margin: 0; padding: 0; }
.weather-details summary { cursor: pointer; list-style: none; outline: none; display: flex; justify-content: space-between; align-items: center; width: 100%; gap: 6px; }
.weather-details summary::-webkit-details-marker { display: none; }

.w-left { flex: 1; color: var(--muted); font-weight: 700; font-size: 11px; display: flex; align-items: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.w-center { flex: 0 0 auto; display: flex; justify-content: center; align-items: center; gap: 5px; font-weight: 900; font-size: 14px; white-space: nowrap; }
.w-right { flex: 1; display: flex; justify-content: flex-end; align-items: center; }

.w-icon-big { font-size: 20px; display: flex; align-items: center; margin-right: 2px; }
.w-divider { color: var(--line); margin: 0 2px; font-weight: 400;}

.w-toggle { 
    background: var(--bg); 
    color: var(--text); 
    font-size: 11px; 
    font-weight: 800; 
    padding: 6px 12px; 
    border-radius: 14px; 
    display: flex; 
    align-items: center; 
    gap: 4px; 
    transition: 0.2s; 
    white-space: nowrap; 
}

/* A√ßƒ±lƒ±r Te≈ühis Kutusu */
.w-advice-box { margin-top: 16px; background: var(--bg); border-radius: 16px; padding: 16px; display: flex; gap: 12px; align-items: flex-start; border: 1px solid var(--line); border-left: 5px solid var(--accent); position: relative; overflow: hidden; animation: slideDown 0.3s ease-out; }
.w-adv-icon { font-size: 24px; }
.w-adv-text { font-size: 13px; font-weight: 600; color: var(--text); line-height: 1.5; }
@keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

/* --- PREMIUM ƒ∞LERLEME BARLARI --- */
.prog-wrapper { display: flex; flex-direction: column; gap: 18px; }
.prog-item { display: flex; flex-direction: column; gap: 8px; }
.prog-header { display: flex; justify-content: space-between; align-items: flex-end; }
.prog-title { font-size: 14px; font-weight: 800; color: var(--text); letter-spacing: -0.2px; }
.prog-stats { display: flex; align-items: baseline; gap: 6px; }
.prog-pct { font-size: 18px; font-weight: 900; letter-spacing: -0.5px; }
.prog-frac { font-size: 12px; font-weight: 700; color: var(--muted); }

.prog-track { background: var(--bg); height: 10px; border-radius: 5px; overflow: hidden; box-shadow: inset 0 1px 3px rgba(0,0,0,0.05); }
.prog-fill { height: 100%; border-radius: 5px; transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); }
.fill-daily { background: var(--prog-daily); box-shadow: 0 0 10px rgba(50, 215, 75, 0.4); }
.fill-month { background: var(--prog-month); box-shadow: 0 0 10px rgba(10, 132, 255, 0.4); }

/* --- MASONRY (BAƒûIMSIZ S√úTUN) D√úZENƒ∞ ƒ∞LA√á KARTLARI --- */
.masonry-grid { display: flex; gap: 12px; margin-bottom: 12px; align-items: flex-start; }
.masonry-col { display: flex; flex-direction: column; gap: 12px; flex: 1; min-width: 0; }

.card { display: flex; flex-direction: column; padding: 16px; margin-bottom: 0;}
.card.done-card { border-color: var(--done-border); background: var(--done-bg); box-shadow: none; }

/* KART BA≈ûLIƒûI */
.card-header { display: flex; flex-direction: column; align-items: flex-start; gap: 6px; margin-bottom: 12px; width: 100%; }
.drug-name { font-size: 14px; font-weight: 800; display: flex; align-items: center; gap: 6px; text-transform: uppercase; margin: 0; white-space: nowrap; color: var(--text); }

.badge { padding: 4px 8px; border-radius: 8px; font-weight: 800; font-size: 11px; text-transform: uppercase; margin: 0; white-space: nowrap; display: flex; align-items: center; gap: 4px; letter-spacing: 0.3px;}
.badge-safe { background: rgba(52, 199, 89, 0.15); color: var(--accent); }
.badge-wait { background: var(--wait-badge-bg); color: var(--wait-badge-text); }

/* OK ANƒ∞MASYONU ƒ∞√áƒ∞N CLASS */
.exp-arrow { transition: transform 0.3s ease; display: inline-block; font-size: 10px; }
.card.collapsed .exp-arrow { transform: rotate(180deg); } 

/* √ñzel SVG ƒ∞konlar */
.check-icon { width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid var(--line); flex-shrink: 0; transition: 0.2s; }
.check-icon.done { background-color: var(--accent); border-color: var(--accent); color: white; box-shadow: 0 2px 6px rgba(52, 199, 89, 0.3); }
.check-icon svg { width: 11px; height: 11px; fill: none; stroke: currentColor; stroke-width: 3; stroke-linecap: round; stroke-linejoin: round; }

/* ƒ∞LA√á Lƒ∞STESƒ∞ SIKI≈ûMA √á√ñZ√úM√ú */
.meds-container { flex: 1; display: flex; flex-direction: column; justify-content: flex-start; gap: 0; transition: opacity 0.3s; }
.history-item { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px dashed var(--line); gap: 10px; }
.history-item:last-child { border-bottom: none; }

.med-info { display: flex; flex-direction: column; justify-content: center; gap: 2px; flex: 1; min-width: 0; }
.drug-title { font-size: 15px; font-weight: 800; color: var(--text); white-space: normal; line-height: 1.2; }
.drug-purpose { font-size: 13px; color: var(--muted); font-weight: 600; font-style: italic; }

/* OTOMATƒ∞K DARALMA */
.card.collapsed { cursor: pointer; }
.card.collapsed .meds-container { display: none; }
.card.collapsed .card-header { margin-bottom: 0; }

/* Mƒ∞Nƒ∞K BUTONU */
.minik-button { position: fixed; bottom: 20px; right: 20px; background: var(--card); width: 64px; height: 64px; border-radius: 32px; display: flex; align-items: center; justify-content: center; font-size: 32px; box-shadow: var(--card-shadow); border: 1px solid var(--card-border); z-index: 1000; cursor: pointer; transition: transform 0.2s; }
.minik-button:active { transform: scale(0.9); }
.minik-toast { position: fixed; bottom: 95px; right: 20px; background: var(--early); color: #fff; padding: 16px; border-radius: 18px; font-size: 13px; font-weight: 800; display: none; z-index: 1001; width: 260px; box-shadow: 0 8px 30px rgba(0,0,0,0.3); line-height: 1.5; text-align: left; }
</style>
</head>
<body onclick="document.getElementById('minikToast').style.display = 'none'">

<div id="alertsArea"></div>

<div class="vip-header">
    <div class="app-title">
        <span class="greeting" id="greetingText">G√ºnaydƒ±n,</span> 
        <span class="name-tag">Nurten Sultan üåº</span>
    </div>
    <div class="header-info">
        <div id="clock" class="clock-text">--:--</div>
        <div id="last-sync" class="sync-badge">üîÑ Baƒülanƒ±yor...</div>
    </div>
</div>

<div class="premium-card">
    <details class="weather-details">
        <summary>
            <div class="w-left">
                üìç Avrupark Hayat
            </div>
            <div class="w-center">
                <span class="w-icon-big" id="wMainIcon">üå•Ô∏è</span> 
                <span id="wTempText">--¬∞C</span>
                <span class="w-divider">‚Ä¢</span>
                <span id="wHumText">%-- Nem</span>
            </div>
            <div class="w-right">
                <div class="w-toggle">√ñneriler <span style="font-size: 9px; margin-left: 2px;">‚ñº</span></div>
            </div>
        </summary>
        <div class="w-advice-box" id="wAdviceBox">
            <div class="w-adv-icon" id="wAdvIcon">ü©∫</div>
            <div class="w-adv-text" id="wAdvice">Hastalƒ±k te≈ühis motoru y√ºkleniyor...</div>
        </div>
    </details>
</div>

<div class="premium-card prog-wrapper">
    <div class="prog-item">
        <div class="prog-header">
            <div class="prog-title">G√ºnl√ºk ƒ∞lerleme</div>
            <div class="prog-stats">
                <span class="prog-pct" id="perf-pct" style="color: var(--accent);">%0</span>
                <span class="prog-frac" id="perf-frac">(0/0)</span>
            </div>
        </div>
        <div class="prog-track">
            <div id="perf-bar" class="prog-fill fill-daily" style="width: 0%;"></div>
        </div>
    </div>
    
    <div class="prog-item">
        <div class="prog-header">
            <div class="prog-title">Aylƒ±k ƒ∞lerleme</div>
            <div class="prog-stats">
                <span class="prog-pct" id="month-pct" style="color: var(--early);">%45</span>
                <span class="prog-frac" id="month-frac">(68/150)</span>
            </div>
        </div>
        <div class="prog-track">
            <div id="month-bar" class="prog-fill fill-month" style="width: 45%;"></div>
        </div>
    </div>
</div>

<div class="masonry-grid">
    <div class="masonry-col" id="col-left"></div>
    <div class="masonry-col" id="col-right"></div>
</div>

<div class="minik-button" onclick="event.stopPropagation(); mewMsg()">üêæ</div>
<div class="minik-toast" id="minikToast">Miyav! ‚ù§Ô∏è</div>

<script>
// KENDƒ∞ Lƒ∞NKƒ∞Nƒ∞ BURAYA YAPI≈ûTIRMAYI UNUTMA
const API_URL = "https://script.google.com/macros/s/AKfycbybibVR75b918CBOMRlpEJu699hHSvOvCFXD6qRAL-JUxmK95HIUcF5onhEQjrIbF67Wg/exec"; 
let sonBasariZamani = 0;
let fetchDevamEdiyor = false;
let apiData = {};

// SVG ƒ∞kon Tanƒ±mlarƒ±
const svgCheck = `<svg viewBox="0 0 14 10"><polyline points="1.5 5 5 8.5 12.5 1"></polyline></svg>`;

// GREETING
const now = new Date();
const hour = now.getHours();
let gMsg = (hour >= 5 && hour < 12) ? "G√ºnaydƒ±n" : (hour >= 12 && hour < 17) ? "T√ºnaydƒ±n" : (hour >= 17 && hour < 22) ? "ƒ∞yi Ak≈üamlar" : "ƒ∞yi Geceler";
document.getElementById('greetingText').innerText = `${gMsg},`;

// GELƒ∞≈ûMƒ∞≈û HAVA DURUMU & TE≈ûHƒ∞S (MANTIK + ƒ∞FADE Bƒ∞RLE≈ûTƒ∞Rƒ∞LDƒ∞)
async function fetchWeather() {
    try {
        const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=41.07&longitude=28.64&current=temperature_2m,relative_humidity_2m');
        const data = await res.json();
        const t = data.current.temperature_2m, h = data.current.relative_humidity_2m;
        
        let icon = "üå•Ô∏è";
        let advIcon = "ü©∫";
        let advColor = "var(--accent)";
        let adv = `Hava bug√ºn senin i√ßin gayet g√ºzel (${t}¬∞C). Romatizma ve Sj√∂gren a√ßƒ±sƒ±ndan en konforlu ve rahat hissedeceƒüin denge durumundasƒ±n. Keyfini √ßƒ±kar!`;
        
        // Akƒ±llƒ± Sƒ±caklƒ±k Rengi
        let tempColor = "var(--text)";
        if (t < 10) tempColor = "#007AFF"; 
        else if (t < 20) tempColor = "#34C759"; 
        else if (t < 28) tempColor = "#FF9500"; 
        else tempColor = "#FF3B30"; 

        // Akƒ±llƒ± Nem Rengi
        let humColor = "var(--text)";
        if (h < 40) humColor = "#FF9500"; 
        else if (h <= 60) humColor = "#34C759"; 
        else if (h <= 75) humColor = "#32ADE6"; 
        else humColor = "#AF52DE"; 
        
        // Mantƒ±kla Birle≈üen Akƒ±llƒ± Te≈ühisler
        if (h > 70 && t < 15) { 
            icon = "üåßÔ∏è"; advIcon = "‚ö†Ô∏è"; advColor = "var(--danger)";
            adv = `Hava soƒüuk ve nemli (%${h}). Nem ve soƒüuk birle≈ütiƒüinde eklem sƒ±vƒ±larƒ±nƒ±n basƒ±ncƒ± deƒüi≈üir; bu durum romatizmal aƒürƒ±larƒ± tetikleyebilir. L√ºtfen dizlerini sƒ±cak tutmaya ve kendini yormamaya √∂zen g√∂ster.`; 
        }
        else if (t < 12) { 
            icon = "ü•∂"; advIcon = "üß£"; advColor = "var(--warning)";
            adv = `Dƒ±≈üarƒ±sƒ± olduk√ßa soƒüuk (${t}¬∞C). Soƒüuk hava eklemleri sertle≈ütirdiƒüi ve Sj√∂gren kaynaklƒ± g√∂z kuruluƒüunu artƒ±rdƒ±ƒüƒ± i√ßin eklemlerini mutlaka sƒ±cak tutmalƒ±, r√ºzgar varsa damlalarƒ±nƒ± kullanmalƒ±sƒ±n.`; 
        }
        else if (h > 75) { 
            icon = "üå´Ô∏è"; advIcon = "üíß"; advColor = "var(--purple)";
            adv = `Nem oranƒ± √ßok y√ºksek (%${h}). Y√ºksek nem eklemlerde aƒüƒ±rlƒ±k hissi ve sabah tutukluƒüunu artƒ±rabileceƒüi i√ßin bug√ºn fiziksel olarak kendini fazla zorlamamaya dikkat etmelisin.`; 
        }
        else if (t > 28) { 
            icon = "‚òÄÔ∏è"; advIcon = "üï∂Ô∏è"; advColor = "var(--warning)";
            adv = `Hava olduk√ßa sƒ±cak (${t}¬∞C). Y√ºksek ƒ±sƒ± v√ºcuttaki sƒ±vƒ± kaybƒ±nƒ± hƒ±zlandƒ±rƒ±p aƒüƒ±z ve g√∂z kuruluƒüunu artƒ±rƒ±r. Bu y√ºzden bol bol su i√ßmeyi ve g√∂z damlalarƒ±nƒ± her zamankinden sƒ±k kullanmayƒ± unutma.`; 
        }
        
        document.getElementById('wMainIcon').innerText = icon;
        
        const tEl = document.getElementById('wTempText');
        tEl.innerText = `${t}¬∞C`;
        tEl.style.color = tempColor;

        const hEl = document.getElementById('wHumText');
        hEl.innerText = `%${h} Nem`;
        hEl.style.color = humColor;

        document.getElementById('wAdvIcon').innerText = advIcon;
        document.getElementById('wAdvice').innerText = adv;
        document.getElementById('wAdviceBox').style.borderLeftColor = advColor;
    } catch(e) { }
}
fetchWeather();

// YENƒ∞: Mƒ∞Nƒ∞K ƒ∞√áƒ∞N Dƒ∞NAMƒ∞K C√úMLE KOMBƒ∞NASYON MOTORU (100.000 Benzersiz ƒ∞htimal)
function mewMsg() {
    const arrA = [
        "Nenesinin kuzusu,", "G√ºzeller g√ºzeli annem,", "Benim canƒ±m nenem,", 
        "Miyav! D√ºnyanƒ±n en iyi ninesi,", "Nurten Sultanƒ±m,", "Pamuk nenem,", 
        "Canƒ±mƒ±n i√ßi,", "En sevdiƒüim insan,", "Tatlƒ± annem,", "Krali√ßem,"
    ];
    const arrB = [
        "≈üimdi Virbac mamamƒ± lƒ±kƒ±r lƒ±kƒ±r yedim,", "az √∂nce G√∂ker'le g√ºzelce oyun oynadƒ±k,", 
        "Alper abim ba≈üƒ±mƒ± ≈üefkatle ok≈üadƒ±,", "ilacƒ±mƒ± (Keppra) hi√ß itiraz etmeden i√ßtim,", 
        "kalbimin ilacƒ±nƒ± (Enalapril) uslu uslu aldƒ±m,", "camdan ku≈ülarƒ± seyrederken seni d√º≈ü√ºnd√ºm,", 
        "patilerimi temizleyip yanƒ±na gelmeye hazƒ±rlanƒ±yorum,", "yumu≈üacƒ±k yataƒüƒ±mda gerinirken aklƒ±ma sen geldin,", 
        "astƒ±mƒ±m bug√ºn √ßok iyi, nefesim pƒ±rƒ±l pƒ±rƒ±l,", "burnumu nemlendirip bƒ±yƒ±klarƒ±mƒ± d√ºzelttim,"
    ];
    const arrC = [
        "sƒ±ra senin ila√ßlarƒ±nda.", "≈üimdi iyile≈üme sƒ±rasƒ± sende.", "g√∂z√ºm s√ºrekli senin panonun √ºst√ºnde.", 
        "G√∂ker'e tembihledim seni hi√ß √ºzmeyecek.", "Alper abime de s√∂yledim, sana √ßok iyi bakacaƒüƒ±z.", 
        "senin de ila√ßlarƒ±nƒ± eksiksiz i√ßtiƒüini biliyorum.", "biz ailecek birbirimize √ßok iyi bakƒ±yoruz.", 
        "senin de damlalarƒ±nƒ± aksatmadƒ±ƒüƒ±nƒ± g√∂rmek istiyorum.", "hadi sen de sularƒ±nƒ± lƒ±kƒ±r lƒ±kƒ±r i√ß.", "birlikte ≈üifa buluyoruz."
    ];
    const arrD = [
        "Eklemlerin hi√ß aƒürƒ±masƒ±n diye o sƒ±cak dizlerine kƒ±vrƒ±lacaƒüƒ±m.", 
        "Cimzia g√ºn√º gelince sakƒ±n korkma, ben hep senin dizinin dibindeyim.", 
        "G√∂z damlalarƒ±nƒ± sƒ±karsan g√∂zlerin benimkiler gibi ƒ±≈üƒ±l ƒ±≈üƒ±l parlar.", 
        "Kortizon g√ºnlerinde l√ºtfen tuzdan uzak dur, tƒ±pkƒ± benim diyet mamam gibi.", 
        "Vitaminlerini i√ß ki benimle daha √ßok oyun oynayabilecek enerjin olsun.", 
        "Romatizman yormasƒ±n diye bug√ºn kendini hi√ß yorma olur mu?", 
        "Sj√∂gren kurutmasƒ±n diye bol su i√ß, ben de kendi suyumu i√ßiyorum.", 
        "Metoartcon iƒüneni olduktan sonra sana mƒ±rƒ±l mƒ±rƒ±l masaj yapacaƒüƒ±m.", 
        "Hepatit korumanƒ± ve vitaminlerini alƒ±nca benim de i√ßim rahat ediyor.", 
        "ƒ∞la√ßlarƒ±nƒ± i√ßmen beni d√ºnyanƒ±n en mutlu kedisi yapƒ±yor."
    ];
    const arrE = [
        "Seni minik kalbimle √ßok ama √ßok seviyorum! ‚ù§Ô∏è", "Islak burnumla yanaklarƒ±ndan √∂p√ºyorum. üêæ", 
        "Bƒ±yƒ±klarƒ±m senin i√ßin ne≈üeyle titriyor! üòª", "Sen yeter ki iyi ol, ben hep senin g√∂lgendeyim. ‚ú®", 
        "Ak≈üama yanƒ±na gelip o g√ºzel ellerini yalayacaƒüƒ±m. üêà", "Mƒ±rƒ±l mƒ±rƒ±l mƒ±rƒ±ldanarak sana kocaman ≈üifa g√∂nderiyorum. üé∂", 
        "Hadi g√ºl√ºmse, senin o g√ºzel y√ºz√ºn hi√ß asƒ±lmasƒ±n. üåº", "Patilerimle boynuna kocaman sarƒ±lƒ±yorum. üêæ", 
        "Bug√ºn de d√ºnyanƒ±n en ≈üanslƒ± kedisiyim √ß√ºnk√º sen varsƒ±n! ü•∞", "Kalbimin atƒ±≈üƒ± hep senin i√ßin! ‚ù§Ô∏è"
    ];

    const pick = arr => arr[Math.floor(Math.random() * arr.length)];
    
    // Rastgele par√ßalarƒ± birle≈ütirerek tam bir paragraf olu≈üturuyoruz.
    const finalMessage = `${pick(arrA)} ${pick(arrB)} ${pick(arrC)} <br><br>${pick(arrD)} ${pick(arrE)}`;

    const t = document.getElementById('minikToast');
    t.innerHTML = finalMessage;
    t.style.display = 'block';
}

// SAAT VE CANLI SENKRONƒ∞ZASYON
function saniyeTiktak() {
    const syncElement = document.getElementById('last-sync');
    const clockElement = document.getElementById('clock');
    const simdi = Date.now();
    const dNow = new Date();
    
    clockElement.textContent = dNow.getDate() + " " + dNow.toLocaleDateString('tr-TR', {month:'short'}) + " ‚Ä¢ " + String(dNow.getHours()).padStart(2,'0') + ':' + String(dNow.getMinutes()).padStart(2,'0');

    const farkSaniye = sonBasariZamani > 0 ? Math.floor((simdi - sonBasariZamani) / 1000) : 999;
    
    if (sonBasariZamani === 0) {
        syncElement.innerHTML = `üîÑ Baƒülanƒ±yor...`; syncElement.style.color = "var(--vip-gold)";
    } else if (farkSaniye < 20) {
        const d = new Date(sonBasariZamani);
        const sn = String(d.getSeconds()).padStart(2,'0');
        syncElement.innerHTML = `üü¢ Canlƒ± (${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}:${sn})`;
        syncElement.style.color = "#4ADE80"; 
    } else if (farkSaniye < 60) {
        syncElement.innerHTML = `üü° Gecikme: ${farkSaniye} sn`; syncElement.style.color = "var(--vip-gold)";
    } else {
        syncElement.innerHTML = `üî¥ Baƒülantƒ± Yok`; syncElement.style.color = "#FF453A";
    }
}

// PROGRAM HESAPLAYICI
function getDailyProgram(dateObj) {
    let day = dateObj.getDay(); let mid = new Date(dateObj.getFullYear(), dateObj.getMonth(), dateObj.getDate());
    let p = [
      { id: 'sabah-ac', title: 'SABAH A√á', time: '06:00', icon: 'üåÖ', meds: [{ key: 'SABAH_AC_INH', name: 'INH', purpose: 'Tbc' }] },
      { id: 'sabah-tok', title: 'SABAH TOK', time: '10:00', icon: 'üç≥', meds: [{ key: 'SABAH_TOK_BALIK', name: 'Balƒ±k Yaƒüƒ±', purpose: 'Destek' }, { key: 'SABAH_TOK_GOZ', name: 'G√∂z Damlasƒ±', purpose: 'Sj√∂gren' }] },
      { id: 'ogle', title: '√ñƒûLE', time: '13:00', icon: '‚òÄÔ∏è', meds: [{ key: 'OGLE_BENEXOL', name: 'Benexol', purpose: 'B12' }] },
      { id: 'aksam', title: 'AK≈ûAM', time: '18:00', icon: 'üåô', meds: [{ key: 'AKSAM_PLAQUENIL', name: 'Plaquenil', purpose: 'Romatizma' }] },
      { id: 'gece', title: 'GECE', time: '21:00', icon: 'üõå', meds: [{ key: 'GECE_QUANTAVIR', name: 'Quantavir', purpose: 'Hepatit' }, { key: 'GECE_GOZ', name: 'G√∂z Damlasƒ±', purpose: 'Sj√∂gren' }] }
    ];
    
    const dS = new Date(2026, 1, 16); 
    if(Math.round((mid - dS)/(1000*60*60*24)) % 2 === 0) p[1].meds.push({ key: 'SABAH_TOK_DELTA', name: 'Deltacortril', purpose: 'Kortizon' });
    if(day === 2) { p[1].meds.push({ key: 'SABAH_TOK_COLEDAN', name: 'Coledan-D3', purpose: 'Vit D' }); p[4].meds.push({ key: 'GECE_FOLBIOL', name: 'Folbiol', purpose: 'Folik' }); }
    if(day === 1) p[4].meds.push({ key: 'GECE_METOARTCON', name: 'Metoartcon', purpose: 'ƒ∞ƒüne' });
    const cS = new Date(2026, 1, 12);
    if(Math.round((mid - cS)/(1000*60*60*24)) % 14 === 0) p[4].meds.push({ key: 'GECE_CIMZIA', name: 'Cimzia ƒ∞ƒünesi', purpose: 'Biyolojik' });
    return p;
}

// VERƒ∞ √áEKME VE EKRAN √áƒ∞Zƒ∞Mƒ∞
async function veriCek() {
    if (fetchDevamEdiyor) return;
    fetchDevamEdiyor = true;
    
    const todayStr = String(now.getDate()).padStart(2, '0') + '.' + String(now.getMonth() + 1).padStart(2, '0') + '.' + now.getFullYear();
    try {
        const res = await fetch(`${API_URL}?tarih=${todayStr}`);
        if (!res.ok) throw new Error("Aƒü Hatasƒ±");
        apiData = await res.json();
        sonBasariZamani = Date.now();
        ekraniCiz();
    } catch(e) { console.error(e); } finally { fetchDevamEdiyor = false; }
}

function ekraniCiz() {
    const todayProg = getDailyProgram(now);
    
    let alertsHTML = "";
    todayProg.forEach(s => {
        s.meds.forEach(m => {
            if(m.key === 'SABAH_TOK_DELTA') alertsHTML += `<div class="safety-shield shield-red" style="display:block;">üö® Bug√ºn Deltacortril G√ºn√º</div>`;
            if(m.key === 'SABAH_TOK_COLEDAN') if(!alertsHTML.includes('Vitamin')) alertsHTML += `<div class="safety-shield shield-yellow" style="display:block;">‚òÄÔ∏è Bug√ºn Vitamin ve Folbiol G√ºn√º</div>`;
            if(m.key === 'GECE_METOARTCON') alertsHTML += `<div class="safety-shield shield-blue" style="display:block;">üß¨ Bug√ºn Metoartcon ƒ∞ƒüne G√ºn√º</div>`;
            if(m.key === 'GECE_CIMZIA') alertsHTML += `<div class="safety-shield shield-purple" style="display:block;">üíâ Bug√ºn Cimzia ƒ∞ƒüne G√ºn√º! ≈ûifa olsun.</div>`;
        });
    });
    document.getElementById('alertsArea').innerHTML = alertsHTML;

    // S√úTUN BAZLI (MASONRY) HTML DAƒûILIMI
    let leftColHTML = "";
    let rightColHTML = "";
    let tMT = 0, tKT = 0;

    todayProg.forEach((s, index) => {
        let sTC = 0; 
        let medsHTML = "";
        
        s.meds.forEach(m => { 
            tMT++; 
            const isDone = apiData[m.key] === "ƒ∞√ßildi";
            if(isDone) { tKT++; sTC++; }
            
            const iconHTML = isDone ? `<div class="check-icon done">${svgCheck}</div>` : `<div class="check-icon"></div>`;
            
            medsHTML += `
                <div class="history-item">
                    ${iconHTML}
                    <div class="med-info">
                        <span class="drug-title">${m.name}</span>
                        <span class="drug-purpose">${m.purpose}</span>
                    </div>
                </div>`; 
        });
        
        const isAllDone = (sTC === s.meds.length);
        const badgeClass = isAllDone ? "badge-safe" : "badge-wait";
        
        const badgeText = isAllDone ? `TAMAMLANDI <span class="exp-arrow">‚ñ≤</span>` : "BEKLƒ∞YOR";
        
        const cardClass = isAllDone ? "done-card collapsed" : "";
        const onClick = isAllDone ? `onclick="this.classList.toggle('collapsed')"` : "";

        const cardElement = `
            <div class="premium-card card ${cardClass}" ${onClick}>
                <div class="card-header">
                    <div class="drug-name">${s.icon} ${s.title}</div>
                    <div class="badge ${badgeClass}">${badgeText}</div>
                </div>
                <div class="meds-container">
                    ${medsHTML}
                </div>
            </div>`;
            
        if (index % 2 === 0) leftColHTML += cardElement;
        else rightColHTML += cardElement;
    });
    
    document.getElementById('col-left').innerHTML = leftColHTML;
    document.getElementById('col-right').innerHTML = rightColHTML;

    const dP = tMT > 0 ? Math.round((tKT/tMT)*100) : 0;
    document.getElementById('perf-pct').innerText = `%${dP}`;
    document.getElementById('perf-frac').innerText = `(${tKT}/${tMT})`;
    document.getElementById('perf-bar').style.width = dP + '%';
}

// 10 Saniyede bir g√ºncelle (aktifken)
veriCek();
setInterval(veriCek, 10000); 
setInterval(saniyeTiktak, 1000); 
// Ekran a√ßƒ±k hale geldiƒüinde anƒ±nda g√ºncelle
document.addEventListener("visibilitychange", () => { if (document.visibilityState === 'visible') veriCek(); });
</script>
</body>
</html>
